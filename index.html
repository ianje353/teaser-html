<!DOCTYPE html>
<html>
  <head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Site Metas -->
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Teaser</title>

    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

    <!-- fonts style -->
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,700|Raleway:400,700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="css/responsive.css" rel="stylesheet" />
  </head>

  <body>
    <div class="hero_area">
      <!-- header section strats -->
      <header class="header_section">
        <div class="container-fluid">
          <nav class="navbar navbar-expand-lg custom_nav-container">
            <a class="navbar-brand" href="index.html">
              <img src="images/coconut.png" alt="" />
            </a>
            <div class="navbar-collapse" id="">
              <ul class="navbar-nav justify-content-between">
                <div class="User_option">
                  <li class="">
                    <a class="mr-4" href="Login_Register.html"> Login </a>
                  </li>
                </div>
              </ul>

              <div class="custom_menu-btn">
                <button onclick="openNav()">
                  <span class="s-1"> </span>
                  <span class="s-2"> </span>
                  <span class="s-3"> </span>
                </button>
              </div>
              <div id="myNav" class="overlay">
                <div class="overlay-content">
                  <a href="index.html">HOME</a>
                  <a href="about.html">ABOUT</a>
                  <a href="house.html">HOUSE</a>
                  <a href="price.html">PRICING</a>
                  <a href="contact.html">CONTACT US</a>
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>
      <!-- end header section -->
      <!-- slider section -->
      <section class="slider_section">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-4 offset-md-1">
              <div class="detail-box">
                <h1>
                  <span> Modern</span> <br />
                  Apartment <br />
                  House
                </h1>
                <p></p>
                <div class="btn-box">
                  <a href="" class=""> Read More </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- end slider section -->
    </div>

    <!-- find section -->
    <section class="find_section">
      <div class="container">
        <form action="">
          <div class="form-row">
            <div class="col-md-5">
              <input
                type="text"
                class="form-control"
                placeholder="Serach Your Categories "
              />
            </div>
            <div class="col-md-5">
              <input type="text" class="form-control" placeholder="Location " />
            </div>
            <div class="col-md-2">
              <button type="submit" class="">search</button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- end find section -->

    <!-- about section -->

    <section class="about_section layout_padding-bottom">
      <div class="square-box">
        <img src="images/square.png" alt="" />
      </div>
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <div class="img-box">
              <img src="images/about-img.jpg" alt="" />
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-box">
              <div class="heading_container">
                <h2>About Our Apartment</h2>
              </div>
              <p></p>
              <a href=""> Read More </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- end about section -->

    <!-- New Apartment Form -->
    <section class="add_apartment_section layout_padding-bottom">
      <div class="container-fluid">
        <div class="heading_container">
          <h2>Add New Apartment</h2>
        </div>
        <div class="form_container">
          <form id="apartmentForm">
            <div class="form-group">
              <label for="apartmentTitle">Apartment Title:</label>
              <input
                type="text"
                class="form-control"
                id="apartmentTitle"
                placeholder="Enter title"
                required
              />
            </div>
            <div class="form-group">
              <label for="apartmentDescription">Apartment Description:</label>
              <textarea
                class="form-control"
                id="apartmentDescription"
                placeholder="Enter description"
                required
              ></textarea>
            </div>
            <div class="form-group">
              <label for="apartmentImageUrl">Image URL:</label>
              <input
                type="text"
                class="form-control"
                id="apartmentImageUrl"
                placeholder="Enter image URL"
                required
              />
            </div>
            <div class="form-group">
              <label for="apartmentPrice">Price:</label>
              <input
                type="text"
                class="form-control"
                id="apartmentPrice"
                placeholder="Enter Price"
                required
              />
            </div>
            <div class="form-group">
              <label for="apartmentLocation">Location:</label>
              <input
                type="text"
                class="form-control"
                id="apartmentLocation"
                placeholder="Enter Location"
                required
              />
            </div>
            <div class="text-center">
              <button type="submit" class="btn btn-primary">
                Add Apartment
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Section to display apartments -->
    <section class="sale_container container mt-5">
      <div class="heading_container">
        <h2>Our Apartments</h2>
      </div>
      <div class="row" id="apartmentsRow">
        <!-- Existing apartments will be listed here as cards -->
      </div>
    </section>
    <!-- Modal for Apartment Details -->
    <div
      class="modal fade"
      id="apartmentModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="apartmentModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="apartmentModalLabel">
              Apartment Details
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="apartmentDetails">
            <!-- Apartment details will be displayed here -->
            <div class="row">
              <div class="col-md-6">
                <img
                  src=""
                  class="img-fluid"
                  alt="Apartment Image"
                  id="modalApartmentImage"
                />
              </div>
              <div class="col-md-6">
                <p>
                  <strong>Title:</strong> <span id="modalApartmentTitle"></span>
                </p>
                <p>
                  <strong>Description:</strong>
                  <span id="modalApartmentDescription"></span>
                </p>
                <p>
                  <strong>Price:</strong> <span id="modalApartmentPrice"></span>
                </p>
                <p>
                  <strong>Location:</strong>
                  <span id="modalApartmentLocation"></span>
                </p>
                <!-- Add the Update button here -->
                <button class="btn btn-primary" id="updateApartmentBtn">
                  Update
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- deal section -->

    <section class="deal_section layout_padding-bottom">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <div class="detail-box">
              <div class="heading_container">
                <h2>Very Good Deal For House</h2>
              </div>
              <p></p>
              <a href=""> Get A Quote </a>
            </div>
          </div>
          <div class="col-md-6">
            <div class="img-box">
              <div class="box b1">
                <img src="images/d-1.jpg" alt="" />
              </div>
              <div class="box b1">
                <img src="images/d-2.jpg" alt="" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- end deal section -->

    <!-- us section -->
    <section class="us_section layout_padding2">
      <div class="container">
        <div class="heading_container">
          <h2>Why Choose Us</h2>
        </div>
        <div class="row">
          <div class="col-md-3 col-sm-6">
            <div class="box">
              <div class="img-box">
                <img src="images/u-1.png" alt="" />
              </div>
              <div class="detail-box">
                <h3 class="price">1000+</h3>
                <h5>Years of House</h5>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="box">
              <div class="img-box">
                <img src="images/u-2.png" alt="" />
              </div>
              <div class="detail-box">
                <h3>20000+</h3>
                <h5>Projects Delivered</h5>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="box">
              <div class="img-box">
                <img src="images/u-3.png" alt="" />
              </div>
              <div class="detail-box">
                <h3>10000+</h3>
                <h5>Satisfied Customers</h5>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="box">
              <div class="img-box">
                <img src="images/u-4.png" alt="" />
              </div>
              <div class="detail-box">
                <h3>1500+</h3>
                <h5>Cheap Rates</h5>
              </div>
            </div>
          </div>
        </div>
        <div class="btn-box">
          <a href=""> Get A Quote </a>
        </div>
      </div>
    </section>

    <!-- end us section -->

    <!-- client secction -->

    <section class="client_section layout_padding">
      <div class="container-fluid">
        <div class="heading_container">
          <h2>What is Says Our Customer</h2>
        </div>
        <div class="client_container">
          <div
            id="carouselExampleControls"
            class="carousel slide"
            data-ride="carousel"
          >
            <div class="carousel-inner">
              <div class="carousel-item active">
                <div class="box">
                  <div class="img-box">
                    <img src="images/client.jpg" alt="" />
                  </div>
                  <div class="detail-box">
                    <h5>
                      <span>Majority</span>
                      <hr />
                    </h5>
                    <p>
                      There are many variations of passages of Lorem Ipsum
                      available, but the majority have suffered alteration in
                      some form, by injected humour, or randomised words which
                      don't look even slightly believable.
                    </p>
                  </div>
                </div>
              </div>
              <div class="carousel-item">
                <div class="box">
                  <div class="img-box">
                    <img src="images/client.jpg" alt="" />
                  </div>
                  <div class="detail-box">
                    <h5>
                      <span>Majority</span>
                      <hr />
                    </h5>
                    <p>
                      There are many variations of passages of Lorem Ipsum
                      available, but the majority have suffered alteration in
                      some form, by injected humour, or randomised words which
                      don't look even slightly believable.
                    </p>
                  </div>
                </div>
              </div>
              <div class="carousel-item">
                <div class="box">
                  <div class="img-box">
                    <img src="images/client.jpg" alt="" />
                  </div>
                  <div class="detail-box">
                    <h5>
                      <span>Majority</span>
                      <hr />
                    </h5>
                    <p>
                      There are many variations of passages of Lorem Ipsum
                      available, but the majority have suffered alteration in
                      some form, by injected humour, or randomised words which
                      don't look even slightly believable.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <a
              class="carousel-control-prev"
              href="#carouselExampleControls"
              role="button"
              data-slide="prev"
            >
              <span class="sr-only">Previous</span>
            </a>
            <a
              class="carousel-control-next"
              href="#carouselExampleControls"
              role="button"
              data-slide="next"
            >
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- end client section -->

    <!-- contact section -->

    <section class="contact_section">
      <div class="container">
        <div class="heading_container">
          <h2>Get In Touch</h2>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-6 px-0">
            <div class="map_container">
              <div class="map-responsive">
                <iframe
                  src="https://www.google.com/maps/embed/v1/place?key=AIzaSyA0s1a7phLN0iaD6-UE7m4qP-z21pH0eSc&q=Eiffel+Tower+Paris+France"
                  width="600"
                  height="300"
                  frameborder="0"
                  style="border: 0; width: 100%; height: 100%"
                  allowfullscreen
                ></iframe>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-5">
            <div class="form_container">
              <form action="">
                <div>
                  <input type="text" placeholder="Name" />
                </div>
                <div>
                  <input type="email" placeholder="Email" />
                </div>
                <div>
                  <input type="text" placeholder="Phone Number" />
                </div>
                <div>
                  <input
                    type="text"
                    class="message-box"
                    placeholder="Message"
                  />
                </div>
                <div class="d-flex">
                  <button>Send</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- end contact section -->

    <!-- info section -->
    <section class="info_section">
      <div class="container">
        <div class="row">
          <div class="col-md-3">
            <div class="info_contact">
              <h5>About Apartment</h5>
              <div>
                <div class="img-box">
                  <img src="images/location.png" width="18px" alt="" />
                </div>
                <p>Mandug Davao City</p>
              </div>
              <div>
                <div class="img-box">
                  <img src="images/phone.png" width="12px" alt="" />
                </div>
                <p>+01 1234567890</p>
              </div>
              <div>
                <div class="img-box">
                  <img src="images/mail.png" width="18px" alt="" />
                </div>
                <p>PrimeEstate@gmail.com</p>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="info_info">
              <h5>Information</h5>
              <p>
                ipsum dolor sit amet, consectetur adipiscing elit, sed do
                eiusmod tempor incididunt
              </p>
            </div>
          </div>

          <div class="col-md-3">
            <div class="info_links">
              <h5>Useful Link</h5>
              <ul>
                <li>
                  <a href=""> There are many </a>
                </li>
                <li>
                  <a href=""> variations of </a>
                </li>
                <li>
                  <a href=""> passages of </a>
                </li>
                <li>
                  <a href=""> Lorem Ipsum </a>
                </li>
                <li>
                  <a href=""> available, but </a>
                </li>
                <li>
                  <a href=""> the i </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-3">
            <div class="info_form">
              <h5>Newsletter</h5>
              <form action="">
                <input type="email" placeholder="Enter your email" />
                <button>Subscribe</button>
              </form>
              <div class="social_box">
                <a href="">
                  <img src="images/fb.png" alt="" />
                </a>
                <a href="">
                  <img src="images/twitter.png" alt="" />
                </a>
                <a href="">
                  <img src="images/linkedin.png" alt="" />
                </a>
                <a href="">
                  <img src="images/youtube.png" alt="" />
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- end info_section -->

    <!-- footer section -->
    <section class="container-fluid footer_section">
      <div class="container">
        <p>
          &copy; <span id="displayYear"></span> All Rights Reserved By
          <a href="https://html.design/"></a>
        </p>
      </div>
    </section>
    <!-- end  footer section -->

    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/custom.js"></script>
    <script>
      document
        .getElementById("apartmentForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const titleInput = document.getElementById("apartmentTitle");
          const descriptionInput = document.getElementById(
            "apartmentDescription"
          );
          const imageUrlInput = document.getElementById("apartmentImageUrl");
          const priceInput = document.getElementById("apartmentPrice");
          const locationInput = document.getElementById("apartmentLocation");

          if (
            !titleInput ||
            !descriptionInput ||
            !imageUrlInput ||
            !priceInput ||
            !locationInput
          ) {
            alert("One or more input fields are missing.");
            return;
          }

          const title = titleInput.value;
          const description = descriptionInput.value;
          const imageUrl = imageUrlInput.value;
          const price = priceInput.value;
          const location = locationInput.value;

          const newApartment = {
            title: title,
            description: description,
            imageUrl: imageUrl,
            price: price,
            location: location,
          };

          try {
            const response = await fetch(
              "http://localhost:5228/api/Properties1",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(newApartment),
              }
            );

            if (response.ok) {
              alert("Apartment added successfully!");
              await fetchApartments();
            } else {
              console.error("Failed to add apartment:", response.statusText);
              alert("Failed to add apartment. Please try again.");
            }
          } catch (error) {
            console.error("Error adding apartment:", error);
            alert("An error occurred. Please try again later.");
          }
        });

      let apartments = []; // Declare apartments as a global variable

      document.addEventListener("DOMContentLoaded", async function () {
        await fetchApartments();

        document
          .getElementById("apartmentForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const titleInput = document.getElementById("apartmentTitle");
            const descriptionInput = document.getElementById(
              "apartmentDescription"
            );
            const imageUrlInput = document.getElementById("apartmentImageUrl");
            const priceInput = document.getElementById("apartmentPrice");
            const locationInput = document.getElementById("apartmentLocation");

            // Check if any input field is null
            if (
              !titleInput ||
              !descriptionInput ||
              !imageUrlInput ||
              !priceInput ||
              !locationInput
            ) {
              alert("One or more input fields are missing.");
              return;
            }

            // Retrieve values from input fields
            const title = titleInput.value;
            const description = descriptionInput.value;
            const imageUrl = imageUrlInput.value;
            const price = priceInput.value;
            const location = locationInput.value;

            // Rest of your form submission logic goes here...
          });

        // Event listener for View Details button
        document.addEventListener("click", function (event) {
          if (event.target.matches(".view-details-btn")) {
            const apartmentId = event.target.getAttribute("data-apartment-id");
            console.log(
              "View details button clicked for apartment ID:",
              apartmentId
            );
            const apartment = findApartmentById(apartmentId);
            console.log("Apartment details:", apartment);
            displayApartmentDetails(apartment);
          }
        });
      });

      async function fetchApartments() {
        try {
          const response = await fetch("http://localhost:5228/api/Properties1");
          if (response.ok) {
            apartments = await response.json(); // Assign apartments to the global variable
            displayApartments(apartments);
          } else {
            console.error("Failed to fetch apartments:", response.statusText);
          }
        } catch (error) {
          console.error("Error fetching apartments:", error);
        }
      }

      function displayApartments(apartments) {
        const container = document.getElementById("apartmentsRow");
        container.innerHTML = ""; // Clear existing apartments

        apartments.forEach((apartment) => {
          const apartmentHTML = `
                  <div class="col-md-4 mb-4 d-flex">
                      <div class="card w-100">
                          <img src="${apartment.imageUrl}" class="card-img-top" alt="Apartment Image">
                          <div class="card-body d-flex flex-column">
                              <h5 class="card-title">${apartment.title}</h5>
                              <p class="card-text">${apartment.location}</p>
                          </div>
                          <div class="card-footer">
                              <button class="btn btn-primary view-details-btn" data-apartment-id="${apartment.id}" data-toggle="modal" data-target="#apartmentModal">View Details</button>
                          </div>
                      </div>
                  </div>
              `;
          container.innerHTML += apartmentHTML;
        });
      }

      function findApartmentById(id) {
        // Find the apartment with the matching ID
        return apartments.find((apartment) => apartment.id == id);
      }

      function displayApartmentDetails(apartment) {
        const modalBody = document.getElementById("apartmentDetails");
        modalBody.innerHTML = `
        <div class="row">
            <div class="col-md-6">
                <img src="${apartment.imageUrl}" class="img-fluid" alt="Apartment Image">
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="updateTitle">Title:</label>
                    <input type="text" class="form-control" id="updateTitle" value="${apartment.title}">
                </div>
                <div class="form-group">
                    <label for="updateDescription">Description:</label>
                    <textarea class="form-control" id="updateDescription">${apartment.description}</textarea>
                </div>
                <div class="form-group">
                    <label for="updateImageUrl">Image URL:</label>
                    <input type="text" class="form-control" id="updateImageUrl" value="${apartment.imageUrl}">
                </div>
                <div class="form-group">
                    <label for="updatePrice">Price:</label>
                    <input type="text" class="form-control" id="updatePrice" value="${apartment.price}">
                </div>
                <div class="form-group">
                    <label for="updateLocation">Location:</label>
                    <input type="text" class="form-control" id="updateLocation" value="${apartment.location}">
                </div>
            </div>
        </div>
    `;
      }
    </script>

    <!-- New JavaScript code for handling "Update" button click event -->
    <script>
      function updateApartment(apartmentId, updatedDetails) {
        // Function to update apartment details
        async function updateApartment(apartmentId, updatedData) {
          try {
            // Convert price to decimal if it's not already
            updatedData.price = parseFloat(updatedData.price);

            const response = await fetch(
              `http://localhost:5228/api/Properties1/${apartmentId}`,
              {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(updatedData),
              }
            );

            if (!response.ok) {
              const errorMessage = await response.text();
              throw new Error(`Unable to update apartment: ${errorMessage}`);
            }

            console.log("Apartment updated successfully");
            // You can perform additional actions here after successful update
          } catch (error) {
            console.error("Error updating apartment:", error.message);
            // Handle the error here (e.g., display an error message to the user)
          }
        }

        document.addEventListener("DOMContentLoaded", async function () {
          await fetchApartments();

          document.addEventListener("click", function (event) {
            if (event.target.matches(".view-details-btn")) {
              const apartmentId =
                event.target.getAttribute("data-apartment-id");
              const apartment = findApartmentById(apartmentId);
              displayApartmentDetails(apartment);
              addUpdateButtonToModal(apartmentId);
              $("#apartmentModal").modal("show"); // Show the modal
            }
          });
        });

        function addUpdateButtonToModal(apartmentId) {
          const updateButton = document.createElement("button");
          updateButton.setAttribute("id", "updateButton");
          updateButton.setAttribute("class", "btn btn-primary");
          updateButton.innerText = "Update";
          updateButton.setAttribute("data-apartment-id", apartmentId);
          updateButton.addEventListener("click", function () {
            const updatedDetails = {
              title: document.getElementById("updateTitle").value,
              description: document.getElementById("updateDescription").value,
              imageUrl: document.getElementById("updateImageUrl").value,
              price: document.getElementById("updatePrice").value,
              location: document.getElementById("updateLocation").value,
            };
            updateApartment(apartmentId, updatedDetails);
          });

          const modalBody = document.getElementById("apartmentDetails");
          modalBody.appendChild(updateButton);
        }
      }
    </script>
  </body>
</html>
